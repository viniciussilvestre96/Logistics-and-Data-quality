import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 1. Loading data
df = pd.read_csv('dynamic_supply_chain_logistics_dataset.csv')
df['timestamp'] = pd.to_datetime(df['timestamp'])

# 2. Distribuição de Riscos
plt.figure(figsize=(10, 6))
sns.countplot(data=df, x='risk_classification', palette='viridis')
plt.title('Distribuição de Classificação de Risco')
plt.savefig('risk_distribution.png')

# 3. Análise de Correlação (Identificar o que causa atrasos)
numerical_cols = df.select_dtypes(include=['float64']).columns
corr_matrix = df[numerical_cols].corr()

plt.figure(figsize=(12, 10))
sns.heatmap(corr_matrix, cmap='coolwarm', annot=False)
plt.title('Mapa de Calor de Correlações Logísticas')
plt.savefig('correlation_heatmap.png')

# 4. Impacto do Tráfego nos Atrasos
plt.figure(figsize=(10, 6))
sns.scatterplot(data=df.sample(1000), x='traffic_congestion_level', 
                y='delivery_time_deviation', hue='risk_classification')
plt.title('Congestionamento vs. Desvio no Tempo de Entrega')
plt.savefig('congestion_vs_delay.png')

# 5. Tendência Temporal de Atrasos
df.set_index('timestamp', inplace=True)
monthly_trend = df['delivery_time_deviation'].resample('ME').mean()
plt.figure(figsize=(12, 6))
monthly_trend.plot(title='Tendência Mensal de Atrasos Médios')
plt.ylabel('Horas de Desvio')
plt.savefig('time_trend_deviation.png')
