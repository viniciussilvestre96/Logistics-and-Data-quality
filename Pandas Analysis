import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns




# Time ordering in order to guarantee the continuity on to guarantee time series graphs
df_limpo = df_limpo.sort_values('timestamp')

# 2. Risk Distribution
plt.figure(figsize=(10, 6))
sns.countplot(data=df_limpo, x='risk_classification', palette='viridis', 
              order=df_limpo['risk_classification'].value_counts().index)
plt.title('Distribuição de Classificação de Risco')
plt.savefig('risk_distribution.png')

# 3. Correlation Matrix
numerical_cols = df_limpo.select_dtypes(include=['float64']).columns
corr_matrix = df_limpo[numerical_cols].corr()

plt.figure(figsize=(12, 10))
sns.heatmap(corr_matrix, cmap='coolwarm', annot=False)
plt.title('Mapa de Calor de Correlações Logísticas')
plt.savefig('correlation_heatmap.png')

# 4.  Impact of Traffic on Delays
plt.figure(figsize=(10, 6))
sns.scatterplot(data=df_limpo.sample(1000), x='traffic_congestion_level', 
                y='delivery_time_deviation', hue='risk_classification', alpha=0.6)
plt.title('Congestionamento vs. Desvio no Tempo de Entrega')
plt.savefig('congestion_vs_delay.png')


#5. Temporal Trend of Delays
df_temporal = df_limpo.set_index('timestamp')
monthly_trend = df_temporal['delivery_time_deviation'].resample('M').mean()

plt.figure(figsize=(12, 6))
monthly_trend.plot(marker='o', color='darkblue', grid=True)
plt.title('Tendência Mensal de Atrasos Médios')
plt.ylabel('Horas de Desvio')
plt.xlabel('Data')
plt.savefig('time_trend_deviation.png')

plt.tight_layout()
